<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/svg+xml" href="%PUBLIC_URL%/favicon.svg" />
  <link rel="alternate icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#4B5563" />
  <meta name="description" content="Yoga Platform Settings" />
  <title>Settings - Yoga Platform</title>
  <!-- Wix SDK Scripts - Only load when in Wix environment -->
  <script>
    // Check if we're in a Wix environment before loading SDK scripts
    (function() {
      var isInWix = window.parent !== window || window.location.href.includes('wix.com');

      if (isInWix) {
        // Load Wix SDK scripts dynamically only when in Wix
        var wixScript = document.createElement('script');
        wixScript.src = '//static.parastorage.com/services/js-sdk/1.469.0/js/wix.min.js';
        wixScript.onerror = function() {
          console.log('Wix SDK script not available - running in standalone mode');
        };
        document.head.appendChild(wixScript);

        var editorScript = document.createElement('script');
        editorScript.src = '//static.parastorage.com/services/editor-platform-host-integration/1.2373.0/index.js';
        editorScript.onerror = function() {
          console.log('Wix Editor integration script not available - running in standalone mode');
        };
        document.head.appendChild(editorScript);
      } else {
        console.log('Not in Wix environment - SDK scripts not loaded');
      }
    })();
  </script>
  <script>
    // Initialize Wix SDK when ready
    window.addEventListener('DOMContentLoaded', function() {
      if (window.Wix) {
        try {
          console.log('Wix SDK available, initializing...');

          // For Settings Panel - get instance ID
          if (window.Wix.Settings && window.Wix.Settings.getInstanceId) {
            const instanceId = window.Wix.Settings.getInstanceId();
            if (instanceId) {
              sessionStorage.setItem('wixInstance', instanceId);
              console.log('Stored instance from Wix Settings:', instanceId);
            }
          }

          // Get site info
          if (window.Wix.getSiteInfo) {
            const siteInfo = window.Wix.getSiteInfo();
            console.log('Wix site info:', siteInfo);

            if (siteInfo) {
              if (siteInfo.siteId) {
                sessionStorage.setItem('wixSiteId', siteInfo.siteId);
              }
              // Store instance from site info if available
              if (siteInfo.instanceId) {
                sessionStorage.setItem('wixInstance', siteInfo.instanceId);
              }
            }
          }

          // Get component info (requires callback)
          if (window.Wix.getComponentInfo) {
            try {
              window.Wix.getComponentInfo(function(compInfo) {
                if (compInfo && compInfo.compId) {
                  sessionStorage.setItem('wixCompId', compInfo.compId);
                  console.log('Stored compId from component info:', compInfo.compId);
                }
              });
            } catch (e) {
              console.log('Error getting component info:', e);
            }
          }

          // Listen for settings updates
          if (window.Wix.addEventListener && window.Wix.Events) {
            window.Wix.addEventListener(window.Wix.Events.SETTINGS_UPDATED, function(data) {
              console.log('Wix settings updated:', data);
              // Trigger React re-render if needed
              window.dispatchEvent(new CustomEvent('wixSettingsUpdated', { detail: data }));
            });
          }
        } catch (e) {
          console.log('Error initializing Wix SDK:', e);
        }
      }
    });
  </script>
</head>
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>
</body>
</html>